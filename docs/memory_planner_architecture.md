# Static Memory Planner - æ¶æ„å¯è§†åŒ–

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Memory Planner                              â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Input: Graph                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”                â”‚ â”‚
â”‚  â”‚  â”‚Conv1 â”‚â”€â”€â”€â–¶â”‚ReLU1 â”‚â”€â”€â”€â–¶â”‚Conv2 â”‚â”€â”€â”€â–¶â”‚ReLU2 â”‚â”€â”€â”€â–¶ Output      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Phase 1: Liveness Analysis                       â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚  Step 1: Topological Sort                                     â”‚ â”‚
â”‚  â”‚    Conv1(0) â†’ ReLU1(1) â†’ Conv2(2) â†’ ReLU2(3)                 â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚  Step 2: Compute Lifetimes                                    â”‚ â”‚
â”‚  â”‚    Conv1_out: [0 â”€â”€â”€â”€â”€â–¶ 1]                                   â”‚ â”‚
â”‚  â”‚    ReLU1_out:      [1 â”€â”€â”€â”€â”€â–¶ 2]                              â”‚ â”‚
â”‚  â”‚    Conv2_out:           [2 â”€â”€â”€â”€â”€â–¶ 3]                         â”‚ â”‚
â”‚  â”‚    ReLU2_out:                [3 â”€â”€â”€â”€â”€â–¶ 4]                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚          Phase 2: Build Interference Graph                    â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚         Conv1_out â”€â”€â”€â”€â”€â”€ ReLU1_out                            â”‚ â”‚
â”‚  â”‚             â”‚                â”‚                                 â”‚ â”‚
â”‚  â”‚             â”‚                â”‚                                 â”‚ â”‚
â”‚  â”‚         Conv2_out â”€â”€â”€â”€â”€â”€ ReLU2_out                            â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚  Edges represent conflicts (overlapping lifetimes)            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           Phase 3: Greedy Coloring                            â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚  Sort by size: Conv1_out > Conv2_out > ReLU1_out > ReLU2_out â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚  Assign colors (pools):                                       â”‚ â”‚
â”‚  â”‚    Conv1_out â†’ Pool 0 (Red)                                   â”‚ â”‚
â”‚  â”‚    Conv2_out â†’ Pool 0 (Red)    âœ“ No conflict!                â”‚ â”‚
â”‚  â”‚    ReLU1_out â†’ Pool 1 (Blue)                                  â”‚ â”‚
â”‚  â”‚    ReLU2_out â†’ Pool 1 (Blue)   âœ“ No conflict!                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                Output: Memory Plan                            â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚  Pool 0 (Red):  max(Conv1_out, Conv2_out) = 1.0 MB           â”‚ â”‚
â”‚  â”‚  Pool 1 (Blue): max(ReLU1_out, ReLU2_out) = 0.5 MB           â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚  Total: 1.5 MB (vs 2.3 MB original) â†’ Save 35%               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•°æ®æµ

```
Graph
  â”‚
  â”œâ”€â–¶ LivenessAnalyzer::analyze()
  â”‚     â”‚
  â”‚     â”œâ”€â–¶ topological_sort()
  â”‚     â”‚     â””â”€â–¶ [Conv1, ReLU1, Conv2, ReLU2]
  â”‚     â”‚
  â”‚     â”œâ”€â–¶ compute_producers_consumers()
  â”‚     â”‚     â””â”€â–¶ {Conv1_out: producer=Conv1, consumers=[ReLU1]}
  â”‚     â”‚
  â”‚     â””â”€â–¶ compute_lifetimes()
  â”‚           â””â”€â–¶ [TensorLifetime{name, size, birth, death}]
  â”‚
  â”œâ”€â–¶ MemoryPlanner::build_interference_graph()
  â”‚     â”‚
  â”‚     â””â”€â–¶ InterferenceGraph
  â”‚           â”œâ”€â–¶ nodes: [Conv1_out, ReLU1_out, ...]
  â”‚           â””â”€â–¶ edges: [(Conv1_out, ReLU1_out), ...]
  â”‚
  â””â”€â–¶ MemoryPlanner::greedy_coloring()
        â”‚
        â”œâ”€â–¶ sort_by_size()
        â”‚     â””â”€â–¶ [Conv1_out, Conv2_out, ReLU1_out, ReLU2_out]
        â”‚
        â”œâ”€â–¶ for each tensor:
        â”‚     â”œâ”€â–¶ find_available_pool()
        â”‚     â”‚     â””â”€â–¶ check conflicts with pool members
        â”‚     â”‚
        â”‚     â””â”€â–¶ assign_to_pool() or create_new_pool()
        â”‚
        â””â”€â–¶ MemoryPlan
              â”œâ”€â–¶ pools: [Pool0, Pool1]
              â”œâ”€â–¶ tensor_to_pool: {Conv1_outâ†’0, ReLU1_outâ†’1, ...}
              â””â”€â–¶ statistics: {total, original, saving_ratio}
```

## ç±»å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MemoryPlanner                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - enabled_: bool                                            â”‚
â”‚ - verbose_: bool                                            â”‚
â”‚ - alignment_: size_t                                        â”‚
â”‚ - liveness_analyzer_: LivenessAnalyzer                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + plan(graph: Graph*): MemoryPlan                           â”‚
â”‚ + set_enabled(enabled: bool)                                â”‚
â”‚ + set_verbose(verbose: bool)                                â”‚
â”‚ + set_alignment(alignment: size_t)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - build_interference_graph(): InterferenceGraph             â”‚
â”‚ - greedy_coloring(): MemoryPlan                             â”‚
â”‚ - find_available_pool(): int                                â”‚
â”‚ - align_size(): size_t                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ uses
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   LivenessAnalyzer                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + analyze(graph: Graph*): vector<TensorLifetime>            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - collect_tensors(): vector<string>                         â”‚
â”‚ - compute_producers_consumers()                             â”‚
â”‚ - is_persistent_tensor(): bool                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ produces
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TensorLifetime                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + name: string                                              â”‚
â”‚ + size_bytes: size_t                                        â”‚
â”‚ + birth_time: int                                           â”‚
â”‚ + death_time: int                                           â”‚
â”‚ + pool_id: int                                              â”‚
â”‚ + is_persistent: bool                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 InterferenceGraph                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - nodes_: unordered_set<string>                             â”‚
â”‚ - adjacency_list_: map<string, set<string>>                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + add_node(tensor: string)                                  â”‚
â”‚ + add_edge(t1: string, t2: string)                          â”‚
â”‚ + has_edge(t1: string, t2: string): bool                    â”‚
â”‚ + get_neighbors(tensor: string): vector<string>             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MemoryPlan                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + pools: vector<MemoryPool>                                 â”‚
â”‚ + tensor_to_pool: map<string, int>                          â”‚
â”‚ + total_memory: size_t                                      â”‚
â”‚ + original_memory: size_t                                   â”‚
â”‚ + memory_saving_ratio: float                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + compute_statistics()                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ contains
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MemoryPool                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + pool_id: int                                              â”‚
â”‚ + size_bytes: size_t                                        â”‚
â”‚ + tensors: vector<string>                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç®—æ³•æµç¨‹å›¾

### ç”Ÿå‘½å‘¨æœŸåˆ†æ

```
Start
  â”‚
  â”œâ”€â–¶ Topological Sort
  â”‚     â”‚
  â”‚     â””â”€â–¶ Assign time stamps to nodes
  â”‚           Node 0, Node 1, Node 2, ...
  â”‚
  â”œâ”€â–¶ For each Tensor:
  â”‚     â”‚
  â”‚     â”œâ”€â–¶ Find producer node
  â”‚     â”‚     â””â”€â–¶ birth_time = producer_time
  â”‚     â”‚
  â”‚     â”œâ”€â–¶ Find all consumer nodes
  â”‚     â”‚     â””â”€â–¶ death_time = max(consumer_times)
  â”‚     â”‚
  â”‚     â””â”€â–¶ Check if persistent
  â”‚           â””â”€â–¶ is_persistent = is_input || is_output || is_weight
  â”‚
  â””â”€â–¶ Return vector<TensorLifetime>
```

### è´ªå¿ƒç€è‰²

```
Start
  â”‚
  â”œâ”€â–¶ Sort tensors by size (descending)
  â”‚     [Large, Medium, Small, ...]
  â”‚
  â”œâ”€â–¶ For each tensor:
  â”‚     â”‚
  â”‚     â”œâ”€â–¶ Try existing pools:
  â”‚     â”‚     â”‚
  â”‚     â”‚     â”œâ”€â–¶ For each pool:
  â”‚     â”‚     â”‚     â”‚
  â”‚     â”‚     â”‚     â”œâ”€â–¶ Check conflicts with pool members
  â”‚     â”‚     â”‚     â”‚     â”‚
  â”‚     â”‚     â”‚     â”‚     â”œâ”€â–¶ No conflict? â†’ Assign to this pool
  â”‚     â”‚     â”‚     â”‚     â”‚                   â””â”€â–¶ Update pool size
  â”‚     â”‚     â”‚     â”‚     â”‚
  â”‚     â”‚     â”‚     â”‚     â””â”€â–¶ Has conflict? â†’ Try next pool
  â”‚     â”‚     â”‚     â”‚
  â”‚     â”‚     â”‚     â””â”€â–¶ All pools checked
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€â–¶ No available pool?
  â”‚     â”‚           â””â”€â–¶ Create new pool
  â”‚     â”‚                 â””â”€â–¶ Assign tensor to new pool
  â”‚     â”‚
  â”‚     â””â”€â–¶ Next tensor
  â”‚
  â””â”€â–¶ Return MemoryPlan
```

## å†…å­˜å¸ƒå±€ç¤ºä¾‹

### ä¼˜åŒ–å‰ï¼ˆç‹¬ç«‹å†…å­˜ï¼‰

```
Time:    0         1         2         3         4
         â”‚         â”‚         â”‚         â”‚         â”‚
Conv1:   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ]
         â”‚ 1.0 MB  â”‚         â”‚         â”‚         â”‚
         â”‚         â”‚         â”‚         â”‚         â”‚
ReLU1:   â”‚         [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ]
         â”‚         â”‚ 0.8 MB  â”‚         â”‚         â”‚
         â”‚         â”‚         â”‚         â”‚         â”‚
Conv2:   â”‚         â”‚         [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ]
         â”‚         â”‚         â”‚ 0.6 MB  â”‚         â”‚
         â”‚         â”‚         â”‚         â”‚         â”‚
ReLU2:   â”‚         â”‚         â”‚         [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ]
         â”‚         â”‚         â”‚         â”‚ 0.4 MB  â”‚

Total Memory: 1.0 + 0.8 + 0.6 + 0.4 = 2.8 MB
```

### ä¼˜åŒ–åï¼ˆå†…å­˜å¤ç”¨ï¼‰

```
Time:    0         1         2         3         4
         â”‚         â”‚         â”‚         â”‚         â”‚
Pool 0:  [â–ˆâ–ˆâ–ˆâ–ˆConv1â–ˆâ–ˆâ–ˆâ–ˆ][â–ˆâ–ˆâ–ˆâ–ˆConv2â–ˆâ–ˆâ–ˆâ–ˆ]
         â”‚ 1.0 MB  â”‚    â”‚ 0.6 MB  â”‚         â”‚
         â”‚         â”‚         â”‚         â”‚         â”‚
Pool 1:  â”‚         [â–ˆâ–ˆâ–ˆâ–ˆReLU1â–ˆâ–ˆâ–ˆâ–ˆ][â–ˆâ–ˆâ–ˆâ–ˆReLU2â–ˆâ–ˆâ–ˆâ–ˆ]
         â”‚         â”‚ 0.8 MB  â”‚    â”‚ 0.4 MB  â”‚

Total Memory: max(1.0, 0.6) + max(0.8, 0.4) = 1.8 MB
Memory Saving: (2.8 - 1.8) / 2.8 = 35.7%
```

## å†²çªå›¾ç¤ºä¾‹

```
Tensor Lifetimes:
  A: [0 â”€â”€â”€â”€â”€â–¶ 2]
  B:      [1 â”€â”€â”€â”€â”€â–¶ 3]
  C:           [2 â”€â”€â”€â”€â”€â–¶ 4]
  D:                [3 â”€â”€â”€â”€â”€â–¶ 5]

Interference Graph:
     A â”€â”€â”€â”€â”€â”€ B
     â”‚        â”‚
     â”‚        â”‚
     C â”€â”€â”€â”€â”€â”€ D

Coloring Result:
  A â†’ Red    (Pool 0)
  B â†’ Blue   (Pool 1)
  C â†’ Blue   (Pool 1)  âœ“ No conflict with B
  D â†’ Red    (Pool 0)  âœ“ No conflict with A

Memory Pools:
  Pool 0 (Red):  {A, D}
  Pool 1 (Blue): {B, C}
```

---

**è¿™äº›å¯è§†åŒ–å›¾è¡¨å¸®åŠ©ç†è§£é™æ€å†…å­˜è§„åˆ’çš„å·¥ä½œåŸç†ï¼** ğŸ“Š
